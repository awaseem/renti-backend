\documentclass{article}
\usepackage{graphicx} % Required to insert images
\usepackage[hidelinks]{hyperref}
\usepackage[usenames,dvipsnames]{color}
\usepackage{listings} % Required for insertion of code
\usepackage{textcomp}
\usepackage{enumitem}
\usepackage{float}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstdefinestyle{sql}
{
    language=SQL,
    showspaces=false,
    basicstyle=\ttfamily,
    numbers=none,
    keywordstyle=\color{blue},          % keyword style
    commentstyle=\color{dkgreen},       % comment style
    stringstyle=\color{mauve},         % string literal style
    upquote=true,
    rulecolor=\color{black},        % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. commens (green here))
    tabsize=3,                      % sets default tabsize to 3 spaces
    captionpos=b,                   % sets the caption-position to bottom
    breaklines=true,                % sets automatic line breaking
    breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
    showstringspaces=false,
}

\lstdefinestyle{js}
{
    language=Java, % There is no javascript...
    showspaces=false,
    basicstyle=\ttfamily,
    numbers=none,
    keywordstyle=\color{blue},          % keyword style
    commentstyle=\color{dkgreen},       % comment style
    stringstyle=\color{mauve},         % string literal style
    upquote=true,
    rulecolor=\color{black},        % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. commens (green here))
    tabsize=3,                      % sets default tabsize to 3 spaces
    captionpos=b,                   % sets the caption-position to bottom
    breaklines=true,                % sets automatic line breaking
    breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
    showstringspaces=false,
}


% Margins
\topmargin=-0.45in
\evensidemargin=0in
\oddsidemargin=0in
\textwidth=6.5in
\textheight=9.0in
\headsep=0.25in

\linespread{1.1} % Line spacing

\title{
\vspace{2in}
\textmd{\textbf{CPSC 471:\ Final Report}}\\
\normalsize\vspace{0.1in}\small{Group Number 3 \\ TA: Ibrahim Karakira}\\
\vspace{3in}
}

\author{Tanner Collin, Jordan Heinrichs, Ali Waseem}
\date{}

\begin{document}
\maketitle
\newpage
\tableofcontents
\newpage

\section{Introduction}
This report discusses the technical specifications and design of Renti, the peer to peer car rental service.
The goal of Renti is to allow the users to easily and effortlessly rent out their vehicles while they are not using them.
We have a similar business model to Airbnb except for cars. This report will cover the system requirements,
deviations from proposed solution, entity-relationship design, object orientated model, and lastly provide a user manual.

\section{System Requirements}

\section{Deviations from Original Requirements}

\section{Entity-Relationship design}
\begin{figure}[ht!]
    \centering
    \includegraphics[keepaspectratio, width=0.8\textwidth]{RelationalModel}
    \caption{Relational Model}
    \label{fig:relationalmodel}
\end{figure}

\section{Object Orientated Model}
The object orientated model is is shown in Figure \ref{fig:oomodel}. For each of the
routes the SQL query is listed.
\begin{figure}[ht!]
    \centering
    \includegraphics[keepaspectratio, width=0.8\textwidth]{ObjectOrientatedDesign}
    \caption{Database Object Orientated Model}
    \label{fig:oomodel}
\end{figure}
\subsection{Users}
The model of the user:

\subsubsection{The public routes:}
\begin{description}
\item[get /api/users/] \mbox{}
\begin{lstlisting}[style=sql]
SELECT u.uid, u.first_name, u.last_name, u.address, u.username, u.email, u.image, u.summary, f.*, userF.uid, userF.first_name, userF.last_name, userF.address, userF.username, userF.email, userF.image, userF.summary, c.*, carF.*, carFUser.uid, carFUser.first_name, carFUser.last_name, carFUser.address, carFUser.username, carFUser.email, carFUser.image, carFUser.summary, t.*, userT.uid, userT.first_name, userT.last_name, userT.address, userT.username, userT.email, userT.image, userT.summary
FROM USER AS u, FEEDBACK_USERS AS f, USER AS userF, USER AS userT, USER AS carFUser, CARS AS c, FEEDBACK_CARS AS carF
WHERE u.uid=f.user_has AND c.user_id=u.uid AND c.license_plate=carF.car_has AND carFUser.uid=carF.user_creator AND c.license_plate=t.car_id AND t.user_renter=userT.uid;
\end{lstlisting}


\item[get /api/users/:id] \mbox{}
\begin{lstlisting}[style=sql]
SELECT u.uid, u.first_name, u.last_name, u.address, u.username, u.email, u.image, u.summary, f.*, userF.uid, userF.first_name, userF.last_name, userF.address, userF.username, userF.email, userF.image, userF.summary, c.*, carF.*, carFUser.uid, carFUser.first_name, carFUser.last_name, carFUser.address, carFUser.username, carFUser.email, carFUser.image, carFUser.summary, t.*, userT.uid, userT.first_name, userT.last_name, userT.address, userT.username, userT.email, userT.image, userT.summary
FROM USER AS u, FEEDBACK_USERS AS f, USER AS userF, USER AS userT, USER AS carFUser, CARS AS c, FEEDBACK_CARS AS carF, TRANSACTIONS as t
WHERE u.uid="id" AND u.uid=f.user_has AND c.user_id=u.uid AND c.license_plate=carF.car_has AND carFUser.uid=carF.user_creator AND c.license_plate=t.car_id AND t.user_renter=userT.uid;

\end{lstlisting}

\item[post /api/users/signup] \mbox{}
\begin{lstlisting}[style=sql]
INSERT INTO USER (image, username, password, first_name, last_name, address, summary, date_of_birth, email)
VALUES ('URL_OF_USER_PHOTO', 'tcollin', 'test', 'Tanner', 'Collin', '123 place rd NW', 'Hi. I love for you to rent one of my cars!', 730869558, 'test@someemail.com');
\end{lstlisting}

\item[post /api/users/signin] \mbox{}
\begin{lstlisting}[style=sql]
SELECT username, password FROM USER where username='tcollin', password='test';
\end{lstlisting}
\end{description}

\subsubsection{The private routes:}
\begin{description}
\item[get /api/users/] \mbox{}
\begin{lstlisting}[style=sql]
SELECT u.uid, u.first_name, u.last_name, u.address, u.username, u.email, u.image, u.summary, f.*, userF.uid, userF.first_name, userF.last_name, userF.address, userF.username, userF.email, userF.image, userF.summary, c.*, carF.*, carFUser.uid, carFUser.first_name, carFUser.last_name, carFUser.address, carFUser.username, carFUser.email, carFUser.image, carFUser.summary, t.*, userT.uid, userT.first_name, userT.last_name, userT.address, userT.username, userT.email, userT.image, userT.summary
FROM USER AS u, FEEDBACK_USERS AS f, USER AS userF, USER AS userT, USER AS carFUser, CARS AS c, FEEDBACK_CARS AS carF, TRANSACTIONS as t, CREDIT_CARD AS cred
WHERE u.uid=f.user_has AND c.user_id=u.uid AND c.license_plate=carF.car_has AND carFUser.uid=carF.user_creator AND c.license_plate=t.car_id AND t.user_renter=userT.uid AND cred.user_id=u.uid;
\end{lstlisting}

\item[put /api/users/] \mbox{}
\begin{lstlisting}[style=sql]
UPDATE USER SET summary='hi my name is tanner' WHERE uid='1';
\end{lstlisting}

\item[delete /api/users/] \mbox{}
\begin{lstlisting}[style=sql]
DELETE FROM USER WHERE uid='1', username='tcollin', password='test';
\end{lstlisting}
\end{description}

\subsection{Credit Card}
The model of the credit card, there are no public routes for credit cards because of security reasons.

\subsubsection{The private routes:}
\begin{description}
\item[post /api/creditCard/] \mbox{}
\begin{lstlisting}[style=sql]
INSERT INTO CREDIT_CARD (credit_card_number, cvv, expiry_date, user_id)
VALUES (347249711260948, 433, 0617, 1);
\end{lstlisting}

\item[delete /api/creditCard/] \mbox{}
\begin{lstlisting}[style=sql]
DELETE FROM CREDIT_CARD as c INNER JOIN USER as u ON c.user_id = a.uid WHERE
a.username='tcollin' AND a.password='test';
\end{lstlisting}
\end{description}

\subsection{Cars}
The model of the cars, contains both public and private routes.
\subsubsection{The public routes:}
\begin{description}
\item[get /api/cars/] \mbox{}
\begin{lstlisting}[style=sql]
SELECT c.*, carF.*, carOwner.uid, carOwner.first_name, carOwner.last_name, carOwner.address, carOwner.username, carOwner.email, carOwner.image, carOwner.summary, carFcreator.uid, carFcreator.first_name, carFcreator.last_name, carFcreator.address, carFcreator.username, carFcreator.email, carFcreator.image, carFcreator.summary, userF.*, userFcreator.uid, userFcreator.first_name, userFcreator.last_name, userFcreator.address, userFcreator.username, userFcreator.email, userFcreator.image, userFcreator.summary,
FROM CARS AS c, FEEDBACK_CARS AS carF, USER AS carOwner, USER AS carFcreator, FEEDBACK_USERS AS userF, USER AS userFcreator
WHERE c.license_plate=carF.car_has AND carFcreator.uid=carF.user_creator AND c.user_id=carOwner.uid AND userF.user_has=carOwner.uid AND userF.user_creator=userFcreator.uid;
\end{lstlisting}
\item[get /api/cars/:plate] \mbox{}
\begin{lstlisting}[style=sql]
SELECT c.*, carF.*, carOwner.uid, carOwner.first_name, carOwner.last_name, carOwner.address, carOwner.username, carOwner.email, carOwner.image, carOwner.summary, carFcreator.uid, carFcreator.first_name, carFcreator.last_name, carFcreator.address, carFcreator.username, carFcreator.email, carFcreator.image, carFcreator.summary, userF.*, userFcreator.uid, userFcreator.first_name, userFcreator.last_name, userFcreator.address, userFcreator.username, userFcreator.email, userFcreator.image, userFcreator.summary,
FROM CARS AS c, FEEDBACK_CARS AS carF, USER AS carOwner, USER AS carFcreator, FEEDBACK_USERS AS userF, USER AS userFcreator
WHERE c.license_plate="plate" AND c.license_plate=carF.car_has AND carFcreator.uid=carF.user_creator AND c.user_id=carOwner.uid AND userF.user_has=carOwner.uid AND userF.user_creator=userFcreator.uid;
\end{lstlisting}
\end{description}

\subsubsection{The private routes:}
\begin{description}
\item[post /api/cars/] \mbox{}
\begin{lstlisting}[style=sql]
INSERT INTO CARS (license_plate, model, make, year, number_of_seats, price, colour, image, summary, user_id)
VALUES ('892WSM', 'Focus RS', 'Ford', 2016, 4, 200, 'Blue', 'URL_OF_CAR_PHOTO', 'This car is fast', 2);
\end{lstlisting}
\item[put /api/cars/] \mbox{}
\begin{lstlisting}[style=sql]
UPDATE CARS SET model='VW', make='Golf R' WHERE license_plate='892WSM' AND user_id='2';
\end{lstlisting}
\item[delete /api/cars/] \mbox{}
\begin{lstlisting}[style=sql]
DELETE FROM CARS AS c WHERE c.uid='2' AND c.license_plate='892WSM';
\end{lstlisting}
\end{description}

\subsection{Transactions}
\subsubsection{The public routes:}
\begin{description}
\item[get /api/transactions/] \mbox{}
\begin{lstlisting}[style=sql]
SELECT * FROM TRANSACTIONS AS t WHERE t.plate='123ABC';
\end{lstlisting}
\item[get /api/transactions/user/:uid] \mbox{}
\begin{lstlisting}[style=sql]
SELECT t.*, c.*,  u.uid, u.first_name, u.last_name, u.address, u.username, u.email, u.image, u.summary
FROM TRANSACTIONS AS t, CAR AS c, USER AS u,
WHERE u.uid="uid" AND c.user_id=u.uid AND t.plate=c.license_plate;
\end{lstlisting}
\end{description}

\subsubsection{The private routes:}
\begin{description}
\item[post /api/transactions/] \mbox{}
\begin{lstlisting}[style=sql]
INSERT INTO TRANSACTIONS (date_in, date_out, price, pending, user_renter, car_id)
VALUES ('2016-3-27', '2016-3-21', 40, 1, '2','123ABC');
\end{lstlisting}
\item[post /api/transactions/approve] \mbox{}
\begin{lstlisting}[style=sql]
UPDATE TRANSACTIONS as t SET pending='0' WHERE c.tid='10' AND EXISTS (Select * FROM CARS as c WHERE t.license_plate=c.license_plate AND c.user_id='2');
\end{lstlisting}
\end{description}

\subsection{Car Feedback}
There are no public routes with car feedback. The feedback is returned with a car get requests.

\subsubsection{The private routes:}
\begin{description}
\item[post /api/carfeedback/] \mbox{}
\begin{lstlisting}[style=sql]
INSERT INTO FEEDBACK_CARS (comment, rating, user_creator, car_has)
VALUES ('This car is really shiny.', '5', '2', '892WSM');
\end{lstlisting}
\item[delete /api/carfeedback/] \mbox{}
\begin{lstlisting}[style=sql]
DELETE FROM FEEDBACK_CARS AS f WHERE f.fid='7' AND f.user_creator='2';
\end{lstlisting}
\end{description}

\subsection{User Feedback}
There are no public routes with user feedback. The feedback is returned with a user get request.

\subsubsection{The private routes:}
\begin{description}
\item[post /api/userfeedback/] \mbox{}
\begin{lstlisting}[style=sql]
INSERT INTO FEEDBACK_USERS (comment, rating, user_creator, user_has)
VALUES ('This user is not friendly.', '2', '2', '1');
\end{lstlisting}
\item[delete /api/userfeedback/] \mbox{}
\begin{lstlisting}[style=sql]
DELETE FROM FEEDBACK_USERS WHERE fid='6' AND user_creator='2';
\end{lstlisting}
\end{description}

\section{General Hierarchical Structure}
This is the hierarchical design of Renti. Most of the database options are available within the user admin page. Otherwise the user is limited to creating transactions and adding feedback.
\begin{figure}[ht!]
    \centering
    \includegraphics[keepaspectratio, width=\textwidth]{HierachicalDesign}
    \caption{Hierarchical design of the application}
    \label{fig:hierachDesign}
\end{figure}

\section{User Manual}

\section{Conclusion}

\section{Appendix A: Filler Data}
The following is the filler data that is used to set up the database. It will be automatically added during an `npm install'.
\lstinputlisting[breaklines, style=js]{../../seeds/filler.js}

\end{document}
